(()=>{"use strict";var e,s,t,a,r={582:e=>{e.exports=require("cors")},142:e=>{e.exports=require("dotenv")},860:e=>{e.exports=require("express")},806:e=>{e.exports=require("helmet")},470:e=>{e.exports=require("morgan")},496:e=>{e.exports=require("sequelize")},638:(e,s,t)=>{t.d(s,{Z:()=>o});var a=t(496);const r="postgres://mainuser:8AQluCn0KKyEy7FSqXnCiyG1rEwn0nEd@dpg-cmni2nmn7f5s73ct39h0-a.oregon-postgres.render.com/ztechnology_db";console.log(r);const o=new a.Sequelize(r,{dialectOptions:{ssl:!0,useUTC:!0},timezone:"-05:00"})},919:(e,s,t)=>{t.d(s,{m:()=>d});var a=t(860);const r=require("bcrypt"),o=require("jsonwebtoken");var n=t(496);function c(e,s){let t={};if(e instanceof n.ValidationError){const{errors:s}=e;let a=[];s.forEach((e=>{const{message:s,path:t,value:r}=e,o={message:s,path:`${t} ${r}`};a.push(o)})),t={message:"SEQ_ERROR",data:a}}else{const{message:s,status:a,path:r}=e;t={message:s,status:a,path:r}}return s.status(e.status).json(t)}var i=t(638);const u={id:{type:n.DataTypes.INTEGER,primaryKey:!0,autoIncrement:!0}},l={createdAt:"createdAt",updatedAt:"updatedAt"},_=(e=>{class s extends n.Model{}return s.init({...u,email:{type:n.DataTypes.STRING,unique:!0,allowNull:!1,validate:{isEmail:!0}},password:{type:n.DataTypes.STRING,allowNull:!1}},{...l,modelName:"userToDo",sequelize:e}),s.beforeSync((()=>{})),s.afterSync((()=>{})),s})(i.Z),p=(0,a.Router)();p.post("/login",(async(e,s)=>{parseInt(process.env.BAN_TIME),console.log("Peticion recibida",e.body);const{email:t,password:a}=e.body;try{if(!t&&!a)throw{message:"Email and password not present",status:400,path:`Email ${t},Password ${a}`};const e=await _.findOne({where:{email:t}});if(!e)throw{message:"User Email does not exists",status:400,path:`Email ${t}`};r.compare(a,e?.dataValues?.password).then((async t=>{if(!t)throw{message:"Invalid - Incorrect password",status:401,path:"Password"};console.log(e?.dataValues?.state,e?.dataValues?.retriesPassword);const a=o.sign({userId:e.dataValues.id,useremail:e.dataValues.email},"ToDo",{expiresIn:"2d"});return s.status(200).json({success:!0,message:"Login Succeess",token:a,data:{user:e.dataValues}})})).catch((e=>(e.status||(e.status=405),c(e,s))))}catch(e){return console.log("______________________________",e),e.status||(e.status=405),c(e,s)}})),p.post("/signup",(async(e,s)=>{console.log("Peticion recibida",e.body);const{email:t,password:a}=e.body;try{if(!t&&!a)throw{message:"Email and password not present",status:400,path:`Email ${t},Password ${a}`};if((await _.findAll({where:{email:t}})).length>0)throw{message:"Email already taken by another user",status:400,path:`Email ${t}`};const e=await r.hash(a,10),o=await _.create({email:t,password:e});return s.status(200).json({success:!0,message:"User Created successfully",data:o})}catch(e){return console.log("______________________________",e),e.status||(e.status=405),c(e,s)}}));const d=p},373:(e,s,t)=>{t.a(e,(async(e,a)=>{try{t.d(s,{Z:()=>d});var r=t(860),o=t(470),n=t(806),c=t(582),i=t(466),u=t(638),l=t(919);const e=()=>{};var _;const p={auth:"/api/auth"};_=r();try{_.use(o("dev")),_.use(n()),_.use(c()),_.use((0,r.json)()),_.use(p.auth,l.m),_.get("/",(async(e,s)=>{const[t,a]=await u.Z.query("SELECT NOW()");s.json({message:"Deberia cambiar carajo",other:t[0]?.now})})),_.use(i.v),await u.Z.authenticate().then((async()=>{e(),await u.Z.sync({force:!1})})).catch((e=>{console.error(e)}))}catch(e){console.log(e)}const d=_;a()}catch(e){a(e)}}),1)},131:(e,s,t)=>{t.a(e,(async(e,s)=>{try{var a=t(373),r=t(142),o=e([a]);a=(o.then?(await o)():o)[0],r.config();const n="8083";a.Z.listen(n,(()=>{console.log(`Listening: http://localhost:${n}`)})),s()}catch(e){s(e)}}))},466:(e,s,t)=>{function a(e,s,t){s.status(404),t(new Error(`🔍 - Not Found - ${e.originalUrl}`))}t.d(s,{v:()=>a})}},o={};function n(e){var s=o[e];if(void 0!==s)return s.exports;var t=o[e]={exports:{}};return r[e](t,t.exports,n),t.exports}e="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",s="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",t="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",a=e=>{e&&e.d<1&&(e.d=1,e.forEach((e=>e.r--)),e.forEach((e=>e.r--?e.r++:e())))},n.a=(r,o,n)=>{var c;n&&((c=[]).d=-1);var i,u,l,_=new Set,p=r.exports,d=new Promise(((e,s)=>{l=s,u=e}));d[s]=p,d[e]=e=>(c&&e(c),_.forEach(e),d.catch((e=>{}))),r.exports=d,o((r=>{var o;i=(r=>r.map((r=>{if(null!==r&&"object"==typeof r){if(r[e])return r;if(r.then){var o=[];o.d=0,r.then((e=>{n[s]=e,a(o)}),(e=>{n[t]=e,a(o)}));var n={};return n[e]=e=>e(o),n}}var c={};return c[e]=e=>{},c[s]=r,c})))(r);var n=()=>i.map((e=>{if(e[t])throw e[t];return e[s]})),u=new Promise((s=>{(o=()=>s(n)).r=0;var t=e=>e!==c&&!_.has(e)&&(_.add(e),e&&!e.d&&(o.r++,e.push(o)));i.map((s=>s[e](t)))}));return o.r?u:n()}),(e=>(e?l(d[t]=e):u(p),a(c)))),c&&c.d<0&&(c.d=0)},n.d=(e,s)=>{for(var t in s)n.o(s,t)&&!n.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:s[t]})},n.o=(e,s)=>Object.prototype.hasOwnProperty.call(e,s),n(131)})();